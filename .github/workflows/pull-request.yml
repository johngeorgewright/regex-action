name: 𝌡   Pull Request

on:
  pull_request:
    branches: [master]

jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    steps:
      - name: 🚚  Checkout project
        uses: actions/checkout@v2

      - name: Parse
        id: parser
        uses: ./
        with:
          ref: refs/tags/@johngw/my-package-v1.2.3
          regex: refs/tags/(?P<package>@johngw/[a-zA-Z0-9_-]+)-v(?P<version>\d+.\d+.\d+)$

      - name: 🧪  Assert Package
        run: |
          PACKAGE='${{ fromJSON(steps.parser.outputs.groups).package }}'
          if [[ $PACKAGE != '@johngw/my-package' ]]
          then
            echo "$PACKAGE does not equal '@johngw/my-package'"
            exit 1
          fi

      - name: 🧪  Assert Version
        run: |
          VERSION='${{ fromJSON(steps.parser.outputs.groups).version }}'
          if [[ $VERSION != '1.2.3' ]]
          then
            echo "$VERSION does not equal '1.2.3'"
            exit 1
          fi
