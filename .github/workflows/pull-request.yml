name: ùå°   Pull Request

on:
  pull_request:
    branches: [master]

jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    steps:
      - name: üöö  Checkout project
        uses: actions/checkout@v3

      - name: Test Single Line
        id: test1
        uses: ./
        with:
          debug: 'true'
          ref: refs/tags/@johngw/my-package-v1.2.3
          regex: refs/tags/(?P<package>@johngw/[a-zA-Z0-9_-]+)-v(?P<version>\d+.\d+.\d+)$

      - name: üß™  Assert Package
        run: |
          PACKAGE='${{ steps.test1.outputs.package }}'
          if [[ $PACKAGE != '@johngw/my-package' ]]
          then
            echo "$PACKAGE does not equal '@johngw/my-package'"
            exit 1
          fi

      - name: üß™  Assert Version
        run: |
          VERSION='${{ steps.test1.outputs.version }}'
          if [[ $VERSION != '1.2.3' ]]
          then
            echo "$VERSION does not equal '1.2.3'"
            exit 1
          fi

      - name: Test Multiline
        id: test2
        uses: ./
        with:
          debug: 'true'
          ref: |
            h
            e
            l
            l
            o
          regex: '[\n\r]*(?P<letter>h)'

      - name: üß™  Assert Multiline
        run: |
          LETTER='${{ steps.test2.outputs.letter }}'
          if [[ $LETTER != 'h' ]]
          then
            echo "$LETTER does not equal 'h'"
            exit 1
          fi

      - name: Test Single Line
        id: test3
        uses: ./
        with:
          asJSON: true
          debug: 'true'
          ref: refs/tags/@johngw/my-package-v1.2.3
          regex: refs/tags/(?P<package>@johngw/[a-zA-Z0-9_-]+)-v(?P<version>\d+.\d+.\d+)$

      - name: üß™  Assert JSON
        run: |
          PACKAGE='${{ fromJSON(steps.test1.outputs.groups).package }}'
          VERSION='${{ fromJSON(steps.test1.outputs.groups).version }}'
          if [[ $PACKAGE != '@johngw/my-package' ]]
          then
            echo "$PACKAGE does not equal '@johngw/my-package'"
            exit 1
          fi
          if [[ $VERSION != '1.2.3' ]]
          then
            echo "$VERSION does not equal '1.2.3'"
            exit 1
          fi
